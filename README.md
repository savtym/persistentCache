# Storage

Реализовано:

  - Локальное кеширование (Persistent Storage) в localStorage браузера
  - Сохранение в RAM (объект JavaScript)
  - Ограничение по максимальному объёму хранилища для RAM и Persistent Storage
  - Ограничение по максимальному объёму хранилища для Persistent Storage, на одну страницу до 5 MiB (основные браузеры предоставляют максимум 5 MiB)
  - Давно неиспользуемые данные вытесняются (Least Recently Used или LRU), что удерживает память в рамках максимального размера
  - Изменения максимального объёма памяти по принципу LRU
  - Добавляет в кеш ключ-значение, значение может быть любого типа, ключ - строка или число
  - Достает данные по ключу, если такого ключа нет - 'undefined'
  - Очистка кеша как для инстанса, так и в общем для страницы
  - Удаление по id Storage, что превращает все ссылки на текущий кеш в null
  - Количество занимаемой памяти конкретным объектом.

## Описание
Библиотека работает по принципу LRU с возможностью изменения максимального размера объёма памяти.

Имеются ограничения для Persistent Storage в виде 5 MiB на страницу. Это связано со спецификой стандартов W3C.

При инстансе Storage создается еще два экземляра классов RAM и Persistent, которые имеют свой функционал. Все данные реализованы в виде приватных свойств класса (геттеры), а также имеются валидации входных данных, частично реализовано через сеттеры. Память высчитывается по принципу занимаемой памяти под каждую основную структуру JavaScript для RAM, а для Persistent - данные переобразуются в json-строку с помощью метода JSON.stringify() и высчитывается длина строки * на 2 байта. localStorage ключ хранит в виде строки, поэтому нужно переводить данные в строку. Если данные некорректны или данные занимают больше объема памяти, чем предоставляется - выкидываются exception с помощью throw: "problem". Пользователь должен их отлавливать с помощью лоического блока try {...} catch(e) { if (e === 'problem') ...}, потому что бизнес-логика не должна возвращать параметры ошибки.

Ошибки throw:
  - "Memory local is full, remove cache!": доступная локальная память заполнена, необходимо очистить
  - "Data is undefined": данные не передали в функцию
  - "Key is undefined": ключ не передали в функцию (пустая строка, 0, false, null - это ключ)
  - "Id is not string or number": передаваемый id не является строкой либо числом
  - "Max size Persistent is less than this data": данные занимают больше, чем максимальный доступный объём в Persistent
  - "Max size RAM is less than this data": данные занимают больше, чем максимальный доступный объём в RAM

Пользователь получает:
  - Доступ к RAM и Persistent с помощью геттера
  - Возможность взять данные по ключу по схеме hit/miss (сначала ищем в RAM и если не найдено, то в Persistent, при отсутствии значения - возвращается 'undefined')
  - Вставка данных в RAM и Persistent по принципу, если значения нет, то добавляем, если значение есть и оно отличается - заменяем
  - Очищения кеша с RAM и Persistent, с помощью реализованой каждой функции у RAM и Persistent
  - Удаление ссылок на RAM и Persistent, а также очистка кеша по тому принципу, что и выше
  - Получение количество запросов в localStorage (аналогия с БД) с помощью геттера
  - Данные в localStorage хранятся в виде: "id" : { "key" : "values" }

Диаграмма взаимодействия: Клиентское приложение --> RAM Storage --> Persistent Storage

## Технологии
  - ES6, babel => es5 + polyfill
  - импорт классов с помощью библиотеки SystemJS
  - nodejs/npm
  - gulp
  - scss
  - autoprefixer css и minifier
  - js minifier
  - git

OS: Linux => Ubuntu:Elementary OS Loki 0.4.1
IDE: WebStorm 2016.3.4


## Установка

Предварительно установив [Node.js](https://nodejs.org/) v7.7+.

После установки выполнить команды в корне папке проекта:

```sh
$ npm install
$ npm install --global gulp
$ gulp
```
Создается папка build в корне проекта, что и является девелопмент-версия, которая минимизированная.

## Автор
### Савицкий Тимофей
[![N|Solid](http://findicons.com/files/icons/2796/metro_uinvert_dock/128/github.png)](https://github.com/savtym/)